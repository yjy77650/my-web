<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ¨‚æ™ºéŠæˆ²æ¸¬è©¦ - å…¨åŠŸèƒ½æ•´åˆç‰ˆ</title>
    <style>
        .screen { animation: fadeIn 0.5s; display: none; padding: 20px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        body { text-align: center; font-family: "Microsoft JhengHei", sans-serif; background: #f0f4f8; margin: 0; padding-top: 20px; }
        #menu-screen { display: block; padding-top: 50px; }
        
        .btn { 
            padding: 20px 40px; font-size: 24px; cursor: pointer; margin: 10px; 
            border-radius: 12px; border: none; background: white; 
            box-shadow: 0 8px 15px rgba(0,0,0,0.1); transition: all 0.3s ease; 
        }
        .btn:hover { transform: translateY(-3px); }
        .back-btn { background: #747d8c; color: white; font-size: 18px; margin-top: 30px; }
        .retry-btn { background: #2ed573; color: white; font-weight: bold; }

        /* --- çµ±ä¸€ä¸Šæ–¹è³‡è¨Šæ¬„ --- */
        .info-bar {
            background: white; border-radius: 20px; padding: 15px;
            display: flex; justify-content: space-around; align-items: center;
            width: 90%; max-width: 500px; margin: 0 auto 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .info-item { text-align: left; font-size: 18px; line-height: 1.5; }
        .highlight { color: #4a90e2; font-weight: bold; }
        .timer { color: #9b59b6; font-size: 28px; font-weight: bold; }
        .pause-btn { background: #f1c40f; color: white; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; border:none; }

        /* --- æŒ‘æˆ°å¡ç‰‡ä»‹é¢ (åˆ†é¡æŒ‘æˆ°ç”¨) --- */
        .challenge-card {
            background: white; width: 90%; max-width: 450px; margin: 0 auto;
            border-radius: 30px; padding: 30px 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        .emoji-display { font-size: 150px; margin: 10px 0; }
        .answer-text { font-size: 60px; color: #d39e00; font-weight: bold; min-height: 80px; margin: 10px 0; }
        .countdown-hint { font-size: 24px; color: #ff4757; font-weight: bold; margin-bottom: 10px; }
        .progress-bar-bg { background: #e0e0e0; height: 10px; width: 80%; border-radius: 10px; margin: 20px auto; overflow: hidden; }
        .progress-bar-fill { background: #4a90e2; height: 100%; width: 0%; }

        /* ç¯€å¥éŠæˆ²å®®æ ¼ */
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 15px; width: 90%; max-width: 400px; margin: 0 auto; background: #fff; padding: 15px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .grid-box { aspect-ratio: 1 / 1; display: flex; align-items: center; justify-content: center; font-size: 60px; color: white; font-weight: bold; border-radius: 15px; position: relative; cursor: pointer; }
        #box-1 { background: #ff7675; } #box-2 { background: #55efc4; } #box-4 { background: #a29bfe; } #box-3 { background: #74b9ff; }
        .active-box::after { content: "â­"; position: absolute; font-size: 50px; }

        /* çµç®—é é¢ */
        .result-card { background: white; padding: 40px; border-radius: 30px; width: 80%; max-width: 400px; margin: 50px auto; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        #final-score { font-size: 80px; color: #ff9f43; font-weight: bold; margin: 20px 0; }

        /* æš«åœ/å€’æ•¸é®ç½© */
        #pause-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; flex-direction: column; justify-content: center; align-items: center; color: white; }
        #resume-countdown { font-size: 120px; font-weight: bold; color: #f1c40f; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        .card {
        aspect-ratio: 1 / 1.3; background: #dfe6e9; border-radius: 15px;
        font-size: 50px; display: flex; align-items: center; justify-content: center;
        cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        transition: transform 0.3s; position: relative;
        }
        .card.flipped { background: white; transform: rotateY(180deg); }
        .card.matched { background: #55efc4; cursor: default; }
        .card-back { color: #636e72; }

    </style>
</head>
<body>

    <div id="pause-overlay">
        <div id="pause-content">
            <h1>â¸ï¸ æš«åœä¸­</h1>
            <button onclick="resumeWithCountdown()" class="btn" style="background: #2ed573; color: white;">â–¶ï¸ ç¹¼çºŒéŠæˆ²</button><br>
            <button onclick="location.reload()" class="btn back-btn">â¬…ï¸ çµæŸä¸¦å›ä¸»é¸å–®</button>
        </div>
        <div id="resume-countdown" style="display:none;">3</div>
    </div>

    <div id="menu-screen" class="screen">
        <h1>ğŸ® æ¨‚æ™ºéŠæˆ²é¸å–®</h1>
        <button onclick="enterChallenge('fruit', 'æ°´æœ')" class="btn">ğŸ æ°´æœæŒ‘æˆ°</button>
        <button onclick="enterChallenge('animal', 'å‹•ç‰©')" class="btn">ğŸ± å‹•ç‰©æŒ‘æˆ°</button>
        <button onclick="enterChallenge('sport', 'çƒé¡')" class="btn">ğŸ€ çƒé¡æŒ‘æˆ°</button>
        <button onclick="enterChallenge('music', 'æ¨‚å™¨')" class="btn">ğŸ¹ æ¨‚å™¨æŒ‘æˆ°</button>
        <button onclick="enterChallenge('trans', 'äº¤é€š')" class="btn">ğŸš— äº¤é€šæŒ‘æˆ°</button>
        <button onclick="enterChallenge('build', 'å»ºç¯‰')" class="btn">ğŸ  å»ºç¯‰æŒ‘æˆ°</button>
        <button onclick="startRhythm()" class="btn" style="background: #ffbe76;">ğŸ¥ ç¯€å¥æ‹æ‰‹æŒ‘æˆ°</button>
        <button onclick="startMemoryGame()" class="btn" style="background: #fe9bddff;">ğŸ´ ç¿»ç‰Œé…å°éŠæˆ²</button>
    </div>

    <div id="game-screen" class="screen">
        <div class="info-bar">
            <div class="info-item">ç›®å‰éŠæˆ²: <span class="highlight" id="info-game-name">æ°´æœ</span><br>å‹•ä½œ: <span class="highlight">å‘½å</span></div>
            <button class="pause-btn" onclick="togglePause(false)">â¸ï¸ æš«åœ</button>
        </div>
        <div class="challenge-card">
            <div id="display-area" class="emoji-display">ğŸ</div>
            <div id="countdown-hint" class="countdown-hint">è«‹æº–å‚™...</div>
            <div id="answer-area" class="answer-text">?</div>
            <div id="pic-index" style="color: #636e72;">åœ–ç‰‡ï¼š1</div>
            <div class="progress-bar-bg"><div id="progress-fill" class="progress-bar-fill"></div></div>
        </div>
        <button id="next-btn" class="btn" style="background: #ff4757; color: white; margin-top: 30px;">ä¸‹ä¸€å€‹</button><br>
        <button onclick="location.reload()" class="btn back-btn">â¬…ï¸ ä¸»é¸å–®</button>
    </div>

    <div id="rhythm-screen" class="screen">
        <div class="info-bar">
            <div class="info-item">ç›®å‰éŠæˆ²: <span class="highlight">ç¯€å¥æ‹æ‰‹</span></div>
            <div class="timer" id="timer-text">00:60</div>
            <button class="pause-btn" onclick="togglePause(true)">â¸ï¸ æš«åœ</button>
        </div>
        <div class="grid-container" id="hit-area">
            <div id="box-1" class="grid-box">1</div>
            <div id="box-2" class="grid-box">2</div>
            <div id="box-4" class="grid-box">4</div>
            <div id="box-3" class="grid-box">3</div>
        </div>
        <p id="score-text" style="font-size: 28px; font-weight: bold;">åˆ†æ•¸ï¼š0</p>
    </div>

    <div id="result-screen" class="screen">
        <div class="result-card">
            <h1>ğŸŠ æŒ‘æˆ°å®Œæˆ ğŸŠ</h1>
            <p style="font-size: 24px;">æœ€çµ‚å¾—åˆ†</p>
            <div id="final-score">0</div>
            <button onclick="startRhythm()" class="btn retry-btn">ğŸ”„ å†ç©ä¸€æ¬¡</button><br>
            <button onclick="location.reload()" class="btn back-btn">ğŸ  è¿”å›ä¸»é¸å–®</button>
        </div>
       </div>
        <div id="memory-screen" class="screen">
    <div id="memory-difficulty-select">
        <h1>ğŸ¯ è«‹é¸æ“‡é›£åº¦</h1>
        <button onclick="initMemoryGame(6)" class="btn" style="background: #55efc4;">ğŸŸ¢ ç°¡å–® (6å¼µ)</button><br>
        <button onclick="initMemoryGame(8)" class="btn" style="background: #74b9ff;">ğŸ”µ ä¸€èˆ¬ (8å¼µ)</button><br>
        <button onclick="initMemoryGame(10)" class="btn" style="background: #ff7675; color:white;">ğŸ”´ å›°é›£ (10å¼µ)</button><br>
        <button onclick="location.reload()" class="btn back-btn">â¬…ï¸ è¿”å›ä¸»é¸å–®</button>
    </div>

    <div id="memory-game-area" style="display:none;">
        <div class="info-bar">
            <div class="info-item">ç›®å‰éŠæˆ²: <span class="highlight">ç¿»ç‰Œé…å°</span></div>
            <button class="pause-btn" onclick="startMemoryGame()">ğŸ”„ é‡é¸é›£åº¦</button>
        </div>
        
        <div id="memory-grid" style="display: grid; grid-gap: 12px; width: 95%; max-width: 600px; margin: 20px auto;">
        </div>

        <h2 id="memory-status" style="color: #4a90e2; min-height: 40px;">è«‹ç¿»é–‹å…©å¼µç‰Œ</h2>
        <button onclick="location.reload()" class="btn back-btn">ğŸ  ä¸»é¸å–®</button>
    </div>
</div>

    <script>
        const dataLists = {
            fruit: [ {e:"ğŸ", n:"è˜‹æœ"}, {e:"ğŸŒ", n:"é¦™è•‰"}, {e:"ğŸ‡", n:"è‘¡è„"}, {e:"ğŸ‰", n:"è¥¿ç“œ"}, {e:"ğŸ“", n:"è‰è“"}, {e:"ğŸ", n:"é³³æ¢¨"} ],
            animal: [ {e:"ğŸ¶", n:"å°ç‹—"}, {e:"ğŸ±", n:"å°è²“"}, {e:"ğŸ°", n:"å…”å­"}, {e:"ğŸ˜", n:"å¤§è±¡"}, {e:"ğŸ¦", n:"ç…å­"}, {e:"ğŸ¦’", n:"é•·é ¸é¹¿"} ],
            sport: [ {e:"ğŸ€", n:"ç±ƒçƒ"}, {e:"âš½", n:"è¶³çƒ"}, {e:"âš¾", n:"æ£’çƒ"}, {e:"ğŸ¾", n:"ç¶²çƒ"}, {e:"ğŸ", n:"æ’çƒ"} ],
            music: [ {e:"ğŸ¹", n:"é‹¼ç´"}, {e:"ğŸ¸", n:"å‰ä»–"}, {e:"ğŸ»", n:"å°æç´"}, {e:"ğŸ·", n:"è–©å…‹æ–¯é¢¨"}, {e:"ğŸ¥", n:"çˆµå£«é¼“"} ],
            trans: [ {e:"ğŸš—", n:"æ±½è»Š"}, {e:"ğŸšŒ", n:"å·´å£«"}, {e:"ğŸš‘", n:"æ•‘è­·è»Š"}, {e:"ğŸš²", n:"è…³è¸è»Š"}, {e:"âœˆï¸", n:"é£›æ©Ÿ"} ],
            build: [ {e:"ğŸ ", n:"æˆ¿å­"}, {e:"ğŸ¢", n:"å¤§æ¨“"}, {e:"ğŸ«", n:"å­¸æ ¡"}, {e:"ğŸ¥", n:"é†«é™¢"}, {e:"â›ª", n:"æ•™å ‚"} ]
        };

        let currentType = '', currentIndex = 0, isRhythmMode = false, isPaused = false;
        let score = 0, timeLeft = 60, lastBox = -1, rhythmTimer, countdownTimer, isBeat = false;
        let answerTimeout, visualCountdownInterval, secondsLeft = 5;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, duration, type='sine') {
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); g.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
            osc.stop(audioCtx.currentTime + duration);
        }

        // --- åˆ†é¡æŒ‘æˆ°é‚è¼¯ ---
        function enterChallenge(type, title) {
            currentType = type; currentIndex = -1; isRhythmMode = false;
            document.getElementById('info-game-name').innerText = title;
            document.getElementById('menu-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            showNextItem();
        }

        document.getElementById('next-btn').onclick = showNextItem;

        function showNextItem() {
            const list = dataLists[currentType];
            currentIndex = (currentIndex + 1) % list.length;
            secondsLeft = 5;
            startChallengeTimer();
        }

        function startChallengeTimer() {
            clearTimeout(answerTimeout); clearInterval(visualCountdownInterval);
            const item = dataLists[currentType][currentIndex];
            document.getElementById('display-area').innerText = item.e;
            document.getElementById('answer-area').innerText = "?";
            document.getElementById('pic-index').innerText = `åœ–ç‰‡ï¼š${currentIndex + 1}`;
            
            const fill = document.getElementById('progress-fill');
            fill.style.transition = 'none';
            fill.style.width = ((5 - secondsLeft) / 5 * 100) + '%';
            setTimeout(() => { fill.style.transition = `width ${secondsLeft}s linear`; fill.style.width = '100%'; }, 50);

            document.getElementById('countdown-hint').innerText = `å…¬å¸ƒç­”æ¡ˆå€’æ•¸ï¼š${secondsLeft}ç§’`;
            if(secondsLeft === 5) window.speechSynthesis.speak(new SpeechSynthesisUtterance("è«‹çœ‹åœ–"));

            visualCountdownInterval = setInterval(() => {
                secondsLeft--;
                if (secondsLeft > 0) document.getElementById('countdown-hint').innerText = `å…¬å¸ƒç­”æ¡ˆå€’æ•¸ï¼š${secondsLeft}ç§’`;
                else { clearInterval(visualCountdownInterval); document.getElementById('countdown-hint').innerText = "ç­”æ¡ˆæ­æ›‰ï¼"; }
            }, 1000);

            answerTimeout = setTimeout(() => {
                document.getElementById('answer-area').innerText = item.n;
                window.speechSynthesis.speak(new SpeechSynthesisUtterance(item.n));
            }, secondsLeft * 1000);
        }

        // --- ç¯€å¥éŠæˆ²é‚è¼¯ ---
        function startRhythm() {
            isRhythmMode = true; score = 0; timeLeft = 60; isPaused = false;
            document.getElementById('score-text').innerText = "åˆ†æ•¸ï¼š0";
            document.getElementById('timer-text').innerText = "00:60";
            document.getElementById('menu-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('rhythm-screen').style.display = 'block';
            startTimers();
        }

        function startTimers() {
            rhythmTimer = setInterval(nextBeat, 1200);
            countdownTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer-text').innerText = `00:${timeLeft < 10 ? '0'+timeLeft : timeLeft}`;
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function nextBeat() {
            if (isPaused) return;
            document.querySelectorAll('.grid-box').forEach(b => b.classList.remove('active-box'));
            let newBox; do { newBox = Math.floor(Math.random() * 4) + 1; } while (newBox === lastBox);
            lastBox = newBox; isBeat = true;
            document.getElementById('box-' + newBox).classList.add('active-box');
            playSound(200, 0.1);
            setTimeout(() => { isBeat = false; document.querySelectorAll('.grid-box').forEach(b => b.classList.remove('active-box')); }, 800);
        }

        document.getElementById('hit-area').onclick = function() {
            if(isBeat && !isPaused && isRhythmMode) {
                score += 10; document.getElementById('score-text').innerText = "åˆ†æ•¸ï¼š" + score;
                isBeat = false; playSound(1000, 0.2);
            }
        };

        function endGame() {
            clearInterval(rhythmTimer); clearInterval(countdownTimer);
            playSound(600, 0.5, 'triangle');
            document.getElementById('rhythm-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('final-score').innerText = score;
            window.speechSynthesis.speak(new SpeechSynthesisUtterance("éŠæˆ²çµæŸï¼Œå¾—åˆ†" + score));
        }

        // --- æš«åœèˆ‡æ¢å¾© ---
        function togglePause(rhythm) {
            isPaused = true;
            if(rhythm) { clearInterval(rhythmTimer); clearInterval(countdownTimer); }
            else { clearTimeout(answerTimeout); clearInterval(visualCountdownInterval); }
            document.getElementById('pause-overlay').style.display = 'flex';
        }

        function resumeWithCountdown() {
            document.getElementById('pause-content').style.display = 'none';
            const counter = document.getElementById('resume-countdown');
            counter.style.display = 'block';
            let c = 3; counter.innerText = c; playSound(440, 0.2);
            let itv = setInterval(() => {
                c--;
                if(c > 0) { counter.innerText = c; playSound(440, 0.2); }
                else {
                    clearInterval(itv); counter.innerText = "GO!"; playSound(880, 0.5);
                    setTimeout(() => {
                        isPaused = false; document.getElementById('pause-overlay').style.display = 'none';
                        document.getElementById('pause-content').style.display = 'block';
                        counter.style.display = 'none';
                        if(isRhythmMode) startTimers(); else if(secondsLeft > 0) startChallengeTimer();
                    }, 500);
                }
            }, 1000);
        }

let flippedCards = [];
let matchedCount = 0;
let canClick = true;
let totalPairs = 0;

// é€²å…¥é›£åº¦é¸æ“‡
function startMemoryGame() {
    document.getElementById('menu-screen').style.display = 'none';
    document.getElementById('rhythm-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'none';
    document.getElementById('result-screen').style.display = 'none';
    
    document.getElementById('memory-screen').style.display = 'block';
    document.getElementById('memory-difficulty-select').style.display = 'block';
    document.getElementById('memory-game-area').style.display = 'none';
}

// åˆå§‹åŒ–éŠæˆ²
function initMemoryGame(cardCount) {
    const icons = ["ğŸ", "ğŸ¶", "ğŸ€", "ğŸ±", "ğŸ‡", "ğŸš—", "ğŸ ", "ğŸ¸", "ğŸˆ", "ğŸ¨"];
    totalPairs = cardCount / 2;
    let selectedIcons = icons.slice(0, totalPairs);
    let deck = [...selectedIcons, ...selectedIcons];
    deck.sort(() => Math.random() - 0.5);

    const grid = document.getElementById('memory-grid');
    grid.innerHTML = '';
    
    // --- å‹•æ…‹èª¿æ•´æ’ç‰ˆ ---
    if (cardCount === 6) {
        grid.style.gridTemplateColumns = 'repeat(3, 1fr)'; // 3x2
    } else if (cardCount === 8) {
        grid.style.gridTemplateColumns = 'repeat(4, 1fr)'; // 4x2
    } else if (cardCount === 10) {
        grid.style.gridTemplateColumns = 'repeat(5, 1fr)'; // 5x2
    }

    matchedCount = 0;
    flippedCards = [];
    canClick = true;
    document.getElementById('memory-status').innerText = "è«‹ç¿»é–‹å…©å¼µç‰Œ";

    deck.forEach((emoji) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.value = emoji;
        card.innerHTML = '<span class="card-back">â“</span>';
        card.onclick = () => flipCard(card);
        grid.appendChild(card);
    });

    document.getElementById('memory-difficulty-select').style.display = 'none';
    document.getElementById('memory-game-area').style.display = 'block';
}

function flipCard(card) {
    if (!canClick || card.classList.contains('flipped') || card.classList.contains('matched')) return;

    playSound(400, 0.1);
    card.classList.add('flipped');
    card.innerText = card.dataset.value;
    flippedCards.push(card);

    if (flippedCards.length === 2) {
        checkMatch();
    }
}

function checkMatch() {
    canClick = false;
    const [card1, card2] = flippedCards;

    if (card1.dataset.value === card2.dataset.value) {
        // é…å°æˆåŠŸ
        setTimeout(() => {
            card1.classList.add('matched');
            card2.classList.add('matched');
            playSound(1000, 0.3);
            matchedCount++;
            flippedCards = [];
            canClick = true;
            if (matchedCount === totalPairs) {
                document.getElementById('memory-status').innerText = "ğŸ‰ æ­å–œé€šé—œï¼";
                window.speechSynthesis.speak(new SpeechSynthesisUtterance("å¤ªæ£’äº†ï¼Œå…¨éƒ¨é…å°æˆåŠŸï¼"));
            } else {
                document.getElementById('memory-status').innerText = "é…å°æˆåŠŸï¼ç¹¼çºŒåŠ æ²¹";
            }
        }, 500);
    } else {
        // é…å°å¤±æ•—
        document.getElementById('memory-status').innerText = "é…å°éŒ¯èª¤ï¼Œè«‹è¨˜ä½ä½ç½®...";
        setTimeout(() => {
            card1.classList.remove('flipped');
            card1.innerHTML = '<span class="card-back">â“</span>';
            card2.classList.remove('flipped');
            card2.innerHTML = '<span class="card-back">â“</span>';
            flippedCards = [];
            canClick = true;
            document.getElementById('memory-status').innerText = "è«‹å†è©¦ä¸€æ¬¡";
        }, 2000); // ç¶­æŒå…©ç§’è®“é•·è¼©è¨˜æ†¶
    }
}
        
    </script>
</body>
</html>
