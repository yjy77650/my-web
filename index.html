<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¨‚æ™ºèªçŸ¥éŠæˆ² - æ——è‰¦æ•´åˆç‰ˆ</title>
    <style>

#main-menu-screen .category-item {
    height: 180px; /* å¢åŠ é«˜åº¦è®“å®ƒæ›´åƒå¤§å¡ç‰‡ */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

#main-menu-screen .category-icon {
    font-size: 70px; /* å¤§åœ–ç¤º */
}

/* åŸºç¤è¨­å®šï¼šè®“å¯¬åº¦è‡ªå‹•é©æ‡‰è¢å¹• */
.screen { 
    max-width: 800px; /* é›»è…¦ç‰ˆæœ€å¤§å¯¬åº¦ï¼Œé¿å…ç•«é¢å¤ªæ‰ */
    margin: 0 auto; 
    padding: 10px;
}

/* åœ–ç‰‡è¾¨åˆ¥èˆ‡ä¸»é¸å–®çš„ç¶²æ ¼ä½ˆå±€å„ªåŒ– */
.category-grid {
    display: grid;
    gap: 15px;
    width: 95%;
    margin: 0 auto;
}

.category-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* ä¸€è¡Œå…©å€‹ï¼ŒæŒ‰éˆ•è¼ƒå¤§å¥½é»æ“Š */
    gap: 20px;
    width: 90%;
    max-width: 450px;
    margin: 20px auto;
}

.category-item {
    background: white;
    padding: 20px 10px;
    border-radius: 25px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    cursor: pointer;
    border: 3px solid #f0f0f0;
}

.category-item:active { transform: scale(0.95); }

.category-icon { font-size: 60px; margin-bottom: 10px; }
.category-label { font-size: 22px; font-weight: bold; color: #333; }

        .screen { animation: fadeIn 0.5s; display: none; padding: 20px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        body { text-align: center; font-family: "Microsoft JhengHei", sans-serif; background: #f0f4f8; margin: 0; padding-top: 20px; overflow-x: hidden; }
        #menu-screen { display: block; padding-top: 50px; }
        
        .btn { 
            padding: 20px 40px; font-size: 24px; cursor: pointer; margin: 10px; 
            border-radius: 12px; border: none; background: white; 
            box-shadow: 0 8px 15px rgba(0,0,0,0.1); transition: all 0.3s ease; 
        }
        .btn:hover { transform: translateY(-3px); background: #f8f9fa; }
        .back-btn { background: #747d8c; color: white; font-size: 18px; margin-top: 30px; }
        .retry-btn { background: #2ed573; color: white; font-weight: bold; }

        .info-bar {
            background: white; border-radius: 20px; padding: 15px;
            display: flex; justify-content: space-around; align-items: center;
            width: 90%; max-width: 500px; margin: 0 auto 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .info-item { text-align: left; font-size: 18px; line-height: 1.5; }
        .highlight { color: #4a90e2; font-weight: bold; }
        .timer { color: #9b59b6; font-size: 28px; font-weight: bold; }
        .pause-btn { background: #f1c40f; color: white; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; border:none; }

        .challenge-card {
            background: white; width: 90%; max-width: 450px; margin: 0 auto;
            border-radius: 30px; padding: 30px 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        .emoji-display { font-size: 150px; margin: 10px 0; }
        .answer-text { font-size: 60px; color: #d39e00; font-weight: bold; min-height: 80px; margin: 10px 0; }
        .countdown-hint { font-size: 24px; color: #ff4757; font-weight: bold; margin-bottom: 10px; }
        .progress-bar-bg { background: #e0e0e0; height: 10px; width: 80%; border-radius: 10px; margin: 20px auto; overflow: hidden; }
        .progress-bar-fill { background: #4a90e2; height: 100%; width: 0%; }

/* 1. å®¹å™¨ä¿æŒä¸è®Š */
.grid-container { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    grid-gap: 15px; width: 90%; 
    max-width: 400px; margin: 0 auto; 
    background: #fff; padding: 15px; 
    border-radius: 25px; 
    box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
}

/* 2. ä¿®æ”¹ï¼šå¢åŠ  transitionï¼Œè®“æ”¾å¤§ç¸®å°æ™‚ä¸æœƒé–ƒç¾ï¼Œè€Œæ˜¯å¹³æ»‘è®Šå‹• */
.grid-box { 
    aspect-ratio: 1 / 1; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    font-size: 60px; 
    color: white; 
    font-weight: bold; 
    border-radius: 15px; 
    position: relative; 
    cursor: pointer; 
    transition: transform 0.15s ease-out, box-shadow 0.15s ease-out; /* é—œéµï¼šå¹³æ»‘æ•ˆæœ */
}

/* 3. é¡è‰²è¨­å®šä¿æŒä¸è®Š */
#box-1 { background: #ff7675; } 
#box-2 { background: #55efc4; } 
#box-3 { background: #74b9ff; }
#box-4 { background: #a29bfe; } 

/* 4. æ–°å¢ï¼šç•¶æ ¼å­è¢«é¸ä¸­æ™‚çš„æ”¾å¤§èˆ‡ç™¼å…‰æ•ˆæœ */
.active-box {
    transform: scale(1.1); /* æ”¾å¤§ 1.1 å€ */
    box-shadow: 0 0 30px #f1c40f; /* é‡‘è‰²å¤–ç™¼å…‰ */
    z-index: 10; /* ç¢ºä¿æ”¾å¤§æ™‚ä¸æœƒè¢«éš”å£æ ¼å­æ“‹ä½ */
}

/* 5. æ˜Ÿæ˜Ÿåœ–æ¡ˆ */
.active-box::after { 
    content: "â­"; 
    position: absolute; 
    font-size: 50px; 
    animation: starPop 0.5s ease-out; /* è®“æ˜Ÿæ˜Ÿå‡ºç¾æ™‚æœ‰å€‹å½ˆå‡ºçš„æ„Ÿè¦º */
}

/* 6. æ–°å¢ï¼šæ˜Ÿæ˜Ÿå½ˆå‡ºå‹•ç•«ï¼ˆé¸é…ï¼Œå¢åŠ è¶£å‘³æ€§ï¼‰ */
@keyframes starPop {
    0% { transform: scale(0); opacity: 0; }
    80% { transform: scale(1.2); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
}

        .grid-container { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 15px; width: 90%; max-width: 400px; margin: 0 auto; background: #fff; padding: 15px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .grid-box { aspect-ratio: 1 / 1; display: flex; align-items: center; justify-content: center; font-size: 60px; color: white; font-weight: bold; border-radius: 15px; position: relative; cursor: pointer; }
        #box-1 { background: #ff7675; } #box-2 { background: #55efc4; } #box-4 { background: #a29bfe; } #box-3 { background: #74b9ff; }
        .active-box::after { content: "â­"; position: absolute; font-size: 50px; }

       /* 1. ç¿»ç‰Œå¡ç‰‡åŸºç¤æ¨£å¼ */
.card {
    aspect-ratio: 1 / 1.3; 
    background: #dfe6e9; 
    border-radius: 15px;
    font-size: 50px; 
    display: flex; 
    align-items: center; 
    justify-content: center;
    cursor: pointer; 
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    transition: transform 0.3s, background-color 0.3s; 
    position: relative;
    color: #2d3436; /* ç¢ºä¿ "?" æˆ–åœ–æ¡ˆé¡è‰²æ¸…æ™° */
}

/* 2. ç¿»é–‹å¾Œçš„æ¨£å¼ */
.card.flipped { 
    background: white; 
    transform: rotateY(180deg); 
}

/* 3. é…å°æˆåŠŸçš„æ¨£å¼ */
.card.matched { 
    background: #55efc4; 
    color: white; /* é…å°æˆåŠŸå¾Œåœ–æ¡ˆè®Šç™½è‰²æ›´é¡¯çœ¼ */
    cursor: default; 
}

#memory-game-area .info-bar {
    display: flex !important; /* å¼·åˆ¶ä½¿ç”¨å½ˆæ€§ä½ˆå±€ */
    flex-direction: row;
    justify-content: center;
    align-items: center;
    gap: 20px;
    min-height: 60px; /* çµ¦äºˆè¶³å¤ é«˜åº¦ */
    background: white;
    border-radius: 15px;
    margin-bottom: 10px;
}

/* 4. æ–°å¢ï¼šç¿»ç‰ŒéŠæˆ²ä¸Šæ–¹çš„æç¤ºæ–‡å­—æ¨£å¼ */
#memory-status {
    font-size: 26px; /* åŠ å¤§å­—é«”è®“é•·è¼©çœ‹æ¸…æ¥š */
    font-weight: bold;
    color: #2c3e50;
    display: inline-block;
    margin: 10px 0;
    min-height: 35px; /* é ç•™é«˜åº¦é˜²æ­¢æ–‡å­—è®Šå‹•æ™‚ç•«é¢è·³å‹• */
}

/* 5. å„ªåŒ–ï¼šèª¿æ•´ç¿»ç‰Œå€åŸŸçš„é–“è· */
#memory-grid {
    display: grid; 
    grid-gap: 12px; 
    width: 95%; 
    max-width: 600px; 
    margin: 20px auto;
}
        #pause-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; flex-direction: column; justify-content: center; align-items: center; color: white; }
        #resume-countdown { font-size: 120px; font-weight: bold; color: #f1c40f; }

        .result-card { background: white; padding: 40px; border-radius: 30px; width: 80%; max-width: 400px; margin: 50px auto; box-shadow: 0 15px 35px rgba(0,0,0,0.1); color: #333; }
        #final-score { font-size: 80px; color: #ff9f43; font-weight: bold; margin: 20px 0; }
    
    /* --- ğŸ“± æ‰‹æ©Ÿç‰ˆ (å¯¬åº¦ 600px ä»¥ä¸‹) --- */
@media (max-width: 600px) {
    .category-grid {
        grid-template-columns: repeat(2, 1fr); /* ä¸€è¡Œå…©å€‹æŒ‰éˆ• */
    }
    .emoji-display { font-size: 100px; } /* ç¸®å° Emoji é¿å…æ‰‹æ©Ÿæº¢å‡º */
    .btn { width: 90%; font-size: 20px; padding: 15px; } /* æŒ‰éˆ•è®Šé•·å¥½é»æ“Š */
    .category-item { height: 140px !important; } /* ç¸®å°å¡ç‰‡é«˜åº¦ */
    .category-icon { font-size: 50px !important; }
}

/* --- Inner Tablet å¹³æ¿ç‰ˆ (å¯¬åº¦ 601px ~ 1024px) --- */
@media (min-width: 601px) and (max-width: 1024px) {
    .category-grid {
        grid-template-columns: repeat(3, 1fr); /* ä¸€è¡Œä¸‰å€‹æŒ‰éˆ• */
    }
    .emoji-display { font-size: 130px; }
    .category-item { height: 160px !important; }
}

/* --- ğŸ’» é›»è…¦ç‰ˆ (å¯¬åº¦ 1025px ä»¥ä¸Š) --- */
@media (min-width: 1025px) {
    .category-grid {
        grid-template-columns: repeat(3, 1fr); /* ä¸€è¡Œä¸‰å€‹ï¼Œæˆ–å››å€‹ */
    }
    .screen {
        padding-top: 40px; /* å¢åŠ ä¸Šæ–¹ç©ºé–“ */
    }
}
    
    </style>
</head>
<body>

    <div id="pause-overlay">
        <div id="pause-content">
            <h1>â¸ï¸ æš«åœä¸­</h1>
            <button onclick="resumeWithCountdown()" class="btn" style="background: #2ed573; color: white;">â–¶ï¸ ç¹¼çºŒéŠæˆ²</button><br>
           <button onclick="handleBackFromPause()" class="btn back-btn">â¬…ï¸ çµæŸä¸¦å›åˆ°ä¸Šä¸€é </button>
        </div>
        <div id="resume-countdown" style="display:none;">3</div>
    </div>

    <div id="main-menu-screen" class="screen" style="display: block;">
    <h1>ğŸŒŸ æ¨‚æ™ºç¶œåˆè¨“ç·´ä¸­å¿ƒ</h1>
    <div class="category-grid">
        <div class="category-item" onclick="showSubMenu('brain')" style="background: #e1f5fe;">
            <div class="category-icon">ğŸ§ </div>
            <div class="category-label">è…¦åŠ›æ¿€ç›ª</div>
        </div>
        <div class="category-item" onclick="showSubMenu('body-logic')" style="background: #fff3e0;">
            <div class="category-icon">âš¡</div>
            <div class="category-label">é«”æ™ºæ´»å‹•</div>
        </div>
        <div class="category-item" style="background: #f1f8e9; opacity: 0.6;">
            <div class="category-icon">ğŸƒ</div>
            <div class="category-label">é«”é©èƒ½(é–‹ç™¼ä¸­)</div>
        </div>
        <div class="category-item" style="background: #fce4ec; opacity: 0.6;">
            <div class="category-icon">ğŸ¤</div>
            <div class="category-label">å”±æ­Œ(é–‹ç™¼ä¸­)</div>
        </div>
    </div>
</div>

<div id="brain-menu-screen" class="screen">
    <h2>ğŸ§  è…¦åŠ›æ¿€ç›ª</h2>
    <button onclick="showCategoryMenu()" class="btn" style="background: #4a90e2; color: white;">ğŸ–¼ï¸ åœ–ç‰‡è¾¨åˆ¥æŒ‘æˆ°</button>
    <button onclick="startMemoryGame()" class="btn" style="background: #a29bfe; color: white;">ğŸ´ ç¿»ç‰Œé…å°</button>
    <button onclick="startCountGame()" class="btn" style="background: #55efc4;">ğŸ”¢ æ•¸é‡æŒ‘æˆ°</button>
    <br>
    <button onclick="showMainMenu()" class="btn back-btn">â¬…ï¸ å›ä¸Šä¸€é </button>
</div>

<div id="body-logic-menu-screen" class="screen">
    <h2>âš¡ é«”æ™ºæ´»å‹•</h2>
    <button onclick="startRhythm()" class="btn" style="background: #ffbe76;">ğŸ¥ ç¯€å¥æ‹æ‰‹</button>
    <button onclick="startBodyGame()" class="btn" style="background: #ffa502;">ğŸ§˜ å¥åº·å‹•å‹•æ“</button>
    <br>
    <button onclick="showMainMenu()" class="btn back-btn">â¬…ï¸ å›ä¸Šä¸€é </button>
</div>

<div id="category-screen" class="screen">
    <h2>ğŸ–¼ï¸ è«‹é¸æ“‡åœ–ç‰‡é¡å‹</h2>
    <div class="category-grid">
        <div class="category-item" onclick="enterChallenge('fruit', 'æ°´æœ')">
            <div class="category-icon">ğŸ</div>
            <div class="category-label">æ°´æœ</div>
        </div>
        <div class="category-item" onclick="enterChallenge('animal', 'å‹•ç‰©')">
            <div class="category-icon">ğŸ±</div>
            <div class="category-label">å‹•ç‰©</div>
        </div>
        <div class="category-item" onclick="enterChallenge('sport', 'çƒé¡')">
            <div class="category-icon">ğŸ€</div>
            <div class="category-label">çƒé¡</div>
        </div>
        <div class="category-item" onclick="enterChallenge('music', 'æ¨‚å™¨')">
            <div class="category-icon">ğŸ¹</div>
            <div class="category-label">æ¨‚å™¨</div>
        </div>
        <div class="category-item" onclick="enterChallenge('trans', 'äº¤é€š')">
            <div class="category-icon">ğŸš—</div>
            <div class="category-label">äº¤é€š</div>
        </div>
        <div class="category-item" onclick="enterChallenge('build', 'å»ºç¯‰')">
            <div class="category-icon">ğŸ </div>
            <div class="category-label">å»ºç¯‰</div>
        </div>
    </div>
    <button onclick="location.reload()" class="btn back-btn">ğŸ  è¿”å›ä¸»é¸å–®</button>
</div>
    <div id="game-screen" class="screen">
        <div class="info-bar">
            <div class="info-item">ç›®å‰éŠæˆ²: <span class="highlight" id="info-game-name">æ°´æœ</span></div>
            <button class="pause-btn" onclick="togglePause(false)">â¸ï¸ æš«åœ</button>
        </div>
        <div class="challenge-card">
            <div id="display-area" class="emoji-display">ğŸ</div>
            <div id="countdown-hint" class="countdown-hint">è«‹æº–å‚™...</div>
            <div id="answer-area" class="answer-text">?</div>
            <div class="progress-bar-bg"><div id="progress-fill" class="progress-bar-fill"></div></div>
        </div>
        <button id="next-btn" class="btn" style="background: #ff4757; color: white; margin-top: 30px;">ä¸‹ä¸€å€‹</button><br>
        
        
       <button onclick="handleBackFromPause()" class="btn back-btn">â¬…ï¸ çµæŸä¸¦å›åˆ°ä¸Šä¸€é </button>
    </div>

    <div id="rhythm-screen" class="screen">
        <div class="info-bar">
            <div class="info-item">ç›®å‰éŠæˆ²: <span class="highlight">ç¯€å¥æ‹æ‰‹</span></div>
            <div class="timer" id="timer-text">00:60</div>
            <button class="pause-btn" onclick="togglePause(true)">â¸ï¸ æš«åœ</button>
        </div>
        <div class="grid-container" id="hit-area">
            <div id="box-1" class="grid-box">1</div>
            <div id="box-2" class="grid-box">2</div>
            <div id="box-4" class="grid-box">4</div>
            <div id="box-3" class="grid-box">3</div>
        </div>
        <p id="score-text" style="font-size: 28px; font-weight: bold;">åˆ†æ•¸ï¼š0</p>
    </div>

    <div id="result-screen" class="screen">
    <div class="result-card">
        <h1>ğŸŠ æŒ‘æˆ°å®Œæˆ ğŸŠ</h1>
        <p style="font-size: 24px;">å¤ªæ£’äº†ï¼æ‚¨ç²å¾—äº†</p>
        <div id="final-score" style="font-size: 80px; color: #ff9f43; font-weight: bold; margin: 20px 0;">0</div>
        <p style="font-size: 24px; margin-bottom: 20px;">åˆ†</p>
        <button onclick="location.reload()" class="btn back-btn">ğŸ  è¿”å›ä¸»é¸å–®</button>
    </div>
</div>

<div id="body-result-screen" class="screen">
    <div class="result-card">
        <h1>ğŸŠ é‹å‹•å®Œæˆ ğŸŠ</h1>
        <p style="font-size: 24px; color: #2ed573; font-weight: bold;">å¤ªæ£’äº†ï¼èº«é«”éƒ½å‹•èµ·ä¾†äº†ï¼</p>
        <div style="font-size: 100px; margin: 20px 0;">ğŸ§˜â€â™‚ï¸</div>
        <button onclick="startBodyGame()" class="btn retry-btn">ğŸ”„ é‡æ–°é–‹å§‹</button><br>
        <button onclick="location.reload()" class="btn back-btn">ğŸ  è¿”å›ä¸»é¸å–®</button>
    </div>
</div>

    <div id="memory-screen" class="screen">
        <div id="memory-difficulty-select">
            <h1>ğŸ¯ é¸æ“‡ç¿»ç‰Œé›£åº¦</h1>
            <button onclick="initMemoryGame(6)" class="btn" style="background: #55efc4;">ğŸŸ¢ ç°¡å–® (6å¼µ)</button><br>
            <button onclick="initMemoryGame(8)" class="btn" style="background: #74b9ff;">ğŸ”µ ä¸€èˆ¬ (8å¼µ)</button><br>
            <button onclick="initMemoryGame(10)" class="btn" style="background: #ff7675; color:white;">ğŸ”´ å›°é›£ (10å¼µ)</button><br>
           
        </div>
        <div id="memory-game-area" style="display:none;">

        
            
                <span id="memory-status">è«‹ç¿»é–‹å…©å¼µç‰Œ</span>
                <button class="pause-btn" onclick="startMemoryGame()">ğŸ”„ é‡é¸é›£åº¦</button>
            </div>
            <div id="memory-grid" style="display: grid; grid-gap: 12px; width: 95%; max-width: 600px; margin: 20px auto;"></div>
            <button onclick="location.reload()" class="btn back-btn">ğŸ  è¿”å›ä¸»é¸å–®</button>
        </div>
        
    </div>

    <div id="count-screen" class="screen">
        <div class="info-bar">
            <div id="count-progress" class="highlight">ç¬¬ 1 / 5 é¡Œ</div>
        </div>
        <div class="challenge-card">
            <div id="count-display-area" style="font-size: 80px; min-height: 150px; display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 10px; padding: 20px;"></div>
            <div style="font-size: 24px; color: #4a90e2; font-weight: bold;">ç•«é¢ä¸­æœ‰å¹¾å€‹ï¼Ÿ</div>
            <div id="count-feedback" style="font-size: 22px; color: #ff4757; height: 35px; margin-top: 5px; font-weight: bold;"></div> 
            
            <div id="count-options" style="display: flex; justify-content: center; gap: 10px; margin-top: 15px;">
                <button onclick="checkCount(1)" class="btn" style="width:75px; height:75px; padding:0;">1</button>
                <button onclick="checkCount(2)" class="btn" style="width:75px; height:75px; padding:0;">2</button>
                <button onclick="checkCount(3)" class="btn" style="width:75px; height:75px; padding:0;">3</button>
                <button onclick="checkCount(4)" class="btn" style="width:75px; height:75px; padding:0;">4</button>
            </div>
        </div>
        <button onclick="location.reload()" class="btn back-btn">ğŸ  è¿”å›ä¸»é¸å–®</button>
    </div>

    <div id="count-result-screen" class="screen">
        <div class="result-card">
            <h1>ğŸŠ æ•¸é‡æŒ‘æˆ°å®Œæˆ ğŸŠ</h1>
            <p style="font-size: 24px; color: #2ed573; font-weight: bold;">å¤ªæ£’äº†ï¼æ‚¨æ•¸å¾—éå¸¸æ­£ç¢ºï¼</p>
            <div style="font-size: 100px; margin: 20px 0;">ğŸ¯</div>
            <button onclick="startCountGame()" class="btn retry-btn">ğŸ”„ å†ç©ä¸€æ¬¡</button><br>
            <button onclick="location.reload()" class="btn back-btn">ğŸ  è¿”å›ä¸»é¸å–®</button>
        </div>
    </div>
    <div id="body-screen" class="screen">
    <div class="info-bar">
        <div class="info-item">ç›®å‰éŠæˆ²: <span class="highlight">å¥åº·å‹•å‹•æ“</span></div>
        <div class="timer" id="body-timer-text">01:00</div>
        <button class="pause-btn" onclick="togglePause(false)">â¸ï¸ æš«åœ</button>
    </div>
    
    <div class="challenge-card">
        <div id="body-display-emoji" class="emoji-display">ğŸ™†â€â™‚ï¸</div>
        <div id="body-display-text" style="font-size: 50px; color: #2f3542; font-weight: bold; margin-bottom: 20px;">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
        <div class="progress-bar-bg"><div id="body-progress-fill" class="progress-bar-fill"></div></div>
    </div>
    <button onclick="location.reload()" class="btn back-btn">ğŸ  è¿”å›ä¸»é¸å–®</button>
</div>

    <script>

    // é¡¯ç¤ºæœ€å¤–å±¤é¸å–®
function showMainMenu() {
    hideAll();
    document.getElementById('main-menu-screen').style.display = 'block';
}

// é¡¯ç¤ºå¤§é¡åˆ¥é¸å–® (è…¦åŠ›æ¿€ç›ª æˆ– é«”æ™ºæ´»å‹•)
function showSubMenu(type) {
    hideAll();
    if(type === 'brain') {
        document.getElementById('brain-menu-screen').style.display = 'block';
    } else if(type === 'body-logic') {
        document.getElementById('body-logic-menu-screen').style.display = 'block';
    }
}

function handleBackFromPause() {
    // 1. å¼·åˆ¶æ¸…é™¤æ‰€æœ‰è¨ˆæ™‚å™¨èˆ‡èªéŸ³ï¼Œç¢ºä¿å®Œå…¨åœæ­¢
    clearTimeout(answerTimeout);
    clearInterval(visualCountdownInterval);
    clearInterval(rhythmTimer);
    clearInterval(countdownTimer);
    if(typeof bodyGameTimer !== 'undefined') clearInterval(bodyGameTimer);
    if(typeof bodyTimer !== 'undefined') clearTimeout(bodyTimer);
    window.speechSynthesis.cancel();

    // 2. é—œé–‰æš«åœé®ç½©
    document.getElementById('pause-overlay').style.display = 'none';

    // 3. æ ¸å¿ƒè·¯å¾‘åˆ¤æ–·
    hideAll(); 

    if (currentType !== '') {
        // å¦‚æœæ˜¯åœ¨ç©åœ–ç‰‡è¾¨åˆ¥ç³»åˆ— -> å›åˆ°ã€Œåœ–ç‰‡åˆ†é¡é¸å–®ã€
        document.getElementById('category-screen').style.display = 'block';
        currentType = ''; // æ¸…ç©ºç‹€æ…‹
    } else if (isRhythmMode || isBodyMode) {
        // é—œéµä¿®æ­£ï¼šå¦‚æœæ˜¯ç¯€å¥æˆ–å‹•å‹•æ“ -> å›åˆ°ã€Œé«”æ™ºæ´»å‹•é¸å–®ã€
        document.getElementById('body-logic-menu-screen').style.display = 'block';
        isRhythmMode = false;
        isBodyMode = false;
    } else {
        // ç¿»ç‰Œã€æ•¸é‡æŒ‘æˆ°æˆ–å…¶ä»– -> å›åˆ°ã€Œè…¦åŠ›æ¿€ç›ªé¸å–®ã€
        document.getElementById('brain-menu-screen').style.display = 'block';
    }
}

    

    function showCategoryMenu() {
    hideAll();
    document.getElementById('category-screen').style.display = 'block';
}

// ä¿®æ­£åŸæœ¬çš„ enterChallengeï¼Œç¢ºä¿å®ƒèƒ½éš±è—æ¬¡é¸å–®
function enterChallenge(type, title) {
    hideAll(); // é€™æœƒéš±è— category-screen
    currentType = type; 
    currentIndex = -1; 
    isRhythmMode = false;
    isBodyMode = false;
    document.getElementById('info-game-name').innerText = title;
    document.getElementById('game-screen').style.display = 'block';
    showNextItem();
}
        // --- åŸºç¤è³‡æ–™ ---
        const dataLists = {
            fruit: [ {e:"ğŸ", n:"è˜‹æœ"}, {e:"ğŸŒ", n:"é¦™è•‰"}, {e:"ğŸ‡", n:"è‘¡è„"}, {e:"ğŸ‰", n:"è¥¿ç“œ"}, {e:"ğŸ“", n:"è‰è“"}, {e:"ğŸ", n:"é³³æ¢¨"}, {e:"ğŸ’", n:"æ«»æ¡ƒ"}, {e:"ğŸ«", n:"è—è“"}, {e:"ğŸ¥­", n:"èŠ’æœ"}, {e:"ğŸ¥", n:"å¥‡ç•°æœ"} ],
            animal: [ {e:"ğŸ¶", n:"å°ç‹—"}, {e:"ğŸ±", n:"å°è²“"}, {e:"ğŸ°", n:"å…”å­"}, {e:"ğŸ˜", n:"å¤§è±¡"}, {e:"ğŸ¦", n:"ç…å­"}, {e:"ğŸ·", n:"å°è±¬"}, {e:"ğŸ’", n:"çŒ´å­"}, {e:"ğŸ¸", n:"é’è›™"}, {e:"ğŸ¦Š", n:"ç‹ç‹¸"}, {e:"ğŸ­", n:"è€é¼ "} ],
            sport: [ {e:"ğŸ€", n:"ç±ƒçƒ"}, {e:"âš½", n:"è¶³çƒ"}, {e:"âš¾", n:"æ£’çƒ"}, {e:"ğŸˆ", n:"æ©„æ¬–çƒ"}, {e:"ğŸ±", n:"æ’çƒ"}, {e:"ğŸ“", n:"ä¹’ä¹“çƒ"}, {e:"â›³ï¸", n:"é«˜çˆ¾å¤«çƒ"}, {e:"ğŸ¸", n:"ç¾½æ¯›çƒ"} ],
            music: [ {e:"ğŸ¹", n:"é‹¼ç´"}, {e:"ğŸ¸", n:"å‰ä»–"}, {e:"ğŸ»", n:"å°æç´"}, {e:"ğŸ¤", n:"éº¥å…‹é¢¨"}, {e:"ğŸ·", n:"è–©å…‹æ–¯é¢¨"}, {e:"ğŸº", n:"å°è™Ÿ"} ],
            trans: [ {e:"ğŸš—", n:"æ±½è»Š"}, {e:"ğŸšŒ", n:"å·´å£«"}, {e:"ğŸš²", n:"è…³è¸è»Š"}, {e:"ğŸš’", n:"æ¶ˆé˜²è»Š"}, {e:"ğŸš“", n:"è­¦å¯Ÿè»Š"}, {e:"ğŸ›µ", n:"æ‘©æ‰˜è»Š"}, {e:"âœˆï¸", n:"é£›æ©Ÿ"} ],
            build: [ {e:"ğŸ ", n:"æˆ¿å­"}, {e:"ğŸ¢", n:"å¤§æ¨“"}, {e:"ğŸ«", n:"å­¸æ ¡"}, {e:"â›ªï¸", n:"æ•™å ‚"}, {e:"ğŸ¥", n:"é†«é™¢"}, {e:"ğŸ¦", n:"éŠ€è¡Œ"}, {e:"â›©ï¸", n:"ç¥ç¤¾"} ]
        };

        let currentType = '', currentIndex = 0, isRhythmMode = false, isPaused = false;
        let score = 0, timeLeft = 60, lastBox = -1, rhythmTimer, countdownTimer, isBeat = false;
        let answerTimeout, visualCountdownInterval, secondsLeft = 5;
        // åœ¨ script æ¨™ç±¤å…§çš„æœ€ä¸Šæ–¹æ‰¾åˆ°è®Šæ•¸å®šç¾©è™•åŠ å…¥
        let isBodyMode = false;

        // éŸ³æ•ˆç³»çµ±
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, duration, type='sine') {
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); g.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
            osc.stop(audioCtx.currentTime + duration);
        }

        // --- é€šç”¨ç•«é¢åˆ‡æ› ---
        function hideAll() {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
        }

        // --- 1. åˆ†é¡æŒ‘æˆ°é‚è¼¯ ---
        function enterChallenge(type, title) {
            hideAll();
            currentType = type; currentIndex = -1; isRhythmMode = false;
            document.getElementById('info-game-name').innerText = title;
            document.getElementById('game-screen').style.display = 'block';
            showNextItem();
        }

        document.getElementById('next-btn').onclick = showNextItem;

        function showNextItem() {
            const list = dataLists[currentType];
            currentIndex = (currentIndex + 1) % list.length;
            secondsLeft = 5;
            startChallengeTimer();
        }

        // æ–°å¢ï¼šå¾æš«åœä¸­æ¢å¾©çš„è¨ˆæ™‚é‚è¼¯
function continueChallengeTimer() {
    const item = dataLists[currentType][currentIndex];
    const fill = document.getElementById('progress-fill');
    
    fill.style.transition = 'none';
    
    // æª¢æŸ¥æ¢å¾©æ™‚æ˜¯å¦å·²ç¶“é€²å…¥ç´…è‰²è­¦æˆ’
    if(secondsLeft <= 2) {
        fill.style.backgroundColor = '#ff4757';
    }

    setTimeout(() => {
        fill.style.transition = `width ${secondsLeft}s linear`;
        fill.style.width = '100%';
    }, 50);

    answerTimeout = setTimeout(() => {
        document.getElementById('answer-area').innerText = item.n;
        window.speechSynthesis.speak(new SpeechSynthesisUtterance(item.n));
    }, secondsLeft * 1000);

    visualCountdownInterval = setInterval(() => {
        secondsLeft--;
        // å€’æ•¸éç¨‹ä¸­ä¹Ÿè¦æª¢æŸ¥ï¼ˆé é˜²å¾3ç§’æ¢å¾©å¾Œè·³åˆ°2ç§’çš„æƒ…æ³ï¼‰
        if(secondsLeft <= 2) {
            fill.style.backgroundColor = '#ff4757';
        }

        if(secondsLeft > 0) {
            document.getElementById('countdown-hint').innerText = `å€’æ•¸ ${secondsLeft} ç§’`;
        } else {
            clearInterval(visualCountdownInterval);
        }
    }, 1000);
}

// ä¿®æ”¹åŸæœ¬çš„ startChallengeTimer
function startChallengeTimer() {
    clearTimeout(answerTimeout); 
    clearInterval(visualCountdownInterval);
    
    secondsLeft = 5; 
    const item = dataLists[currentType][currentIndex];
    document.getElementById('display-area').innerText = item.e;
    document.getElementById('answer-area').innerText = "?";
    
    const fill = document.getElementById('progress-fill');
    fill.style.transition = 'none'; 
    fill.style.width = '0%';
    fill.style.backgroundColor = '#4a90e2'; // 1. é‡è¨­ç‚ºè—è‰²

    setTimeout(() => { 
        fill.style.transition = 'width 5s linear'; 
        fill.style.width = '100%'; 
    }, 50);

    document.getElementById('countdown-hint').innerText = `å€’æ•¸ 5 ç§’`;
    window.speechSynthesis.speak(new SpeechSynthesisUtterance("è«‹çœ‹åœ–"));

    visualCountdownInterval = setInterval(() => {
        secondsLeft--;
        // 2. æª¢æŸ¥ç§’æ•¸è®Šè‰²
        if(secondsLeft <= 2) {
            fill.style.backgroundColor = '#ff4757'; // å‰©ä¸‹2ç§’è®Šç´…è‰²
        }
        
        if(secondsLeft > 0) {
            document.getElementById('countdown-hint').innerText = `å€’æ•¸ ${secondsLeft} ç§’`;
        } else {
            clearInterval(visualCountdownInterval);
        }
    }, 1000);

    answerTimeout = setTimeout(() => {
        document.getElementById('answer-area').innerText = item.n;
        window.speechSynthesis.speak(new SpeechSynthesisUtterance(item.n));
    }, 5000);
}
        // --- 2. æ‹æ‰‹æŒ‘æˆ°é‚è¼¯ ---
        function startRhythm() {
            hideAll();
            isRhythmMode = true; score = 0; timeLeft = 60;
            document.getElementById('rhythm-screen').style.display = 'block';
            startTimers();
        }

        function startTimers() {
            rhythmTimer = setInterval(nextBeat, 1200);
            countdownTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer-text').innerText = `00:${timeLeft<10?'0'+timeLeft:timeLeft}`;
                if(timeLeft<=0) endGame();
            }, 1000);
        }

        function nextBeat() {
            if(isPaused) return;
            document.querySelectorAll('.grid-box').forEach(b => b.classList.remove('active-box'));
            let b = Math.floor(Math.random()*4)+1;
            isBeat = true;
            document.getElementById('box-'+b).classList.add('active-box');
            playSound(200, 0.1);
            setTimeout(() => isBeat = false, 800);
        }

        // ä¿®æ”¹é»æ“Šåˆ¤å®šé‚è¼¯
document.getElementById('hit-area').onclick = function(event) {
    // 1. å–å¾—ä½¿ç”¨è€…é»æ“Šåˆ°çš„ç›®æ¨™å…ƒç´ 
    const clickedElement = event.target;
    
    // 2. æª¢æŸ¥ï¼šå¿…é ˆåœ¨ç¯€æ‹å…§ (isBeat)ã€æ²’æš«åœ (!isPaused)ï¼Œä¸”é»åˆ°çš„æ ¼å­å¸¶æœ‰ 'active-box' é¡åˆ¥
    if(isBeat && !isPaused && clickedElement.classList.contains('active-box')) {
        // --- é»å°äº† ---
        score += 10; 
        document.getElementById('score-text').innerText = "åˆ†æ•¸ï¼š" + score;
        
        // æˆåŠŸå¾Œç«‹åˆ»ç§»é™¤æ˜Ÿæ˜Ÿï¼Œé˜²æ­¢åŒä¸€æ‹é‡è¤‡é»æ“Šå¾—åˆ†
        clickedElement.classList.remove('active-box');
        isBeat = false; 
        
        playSound(1000, 0.2); // é«˜éŸ³ï¼šæ­£ç¢º
    } else if (!isPaused && clickedElement.classList.contains('grid-box')) {
        // --- é»éŒ¯äº† (é¸é…ï¼šå¦‚æœè¦æ‰£åˆ†æˆ–æ”¾éŒ¯èª¤éŸ³æ•ˆå¯ä»¥åŠ åœ¨é€™è£¡) ---
       // playSound(200, 0.05); // ä½éŸ³ï¼šéŒ¯èª¤æç¤º
    }
};

        function endGame() {
    // 1. åœæ­¢æ‰€æœ‰è¨ˆæ™‚å™¨
    clearInterval(rhythmTimer); 
    clearInterval(countdownTimer);
    
    // 2. åˆ‡æ›ç•«é¢
    hideAll();
    document.getElementById('result-screen').style.display = 'block';
    
    // 3. å¡«å…¥æœ€çµ‚åˆ†æ•¸
    document.getElementById('final-score').innerText = score;
    
    // 4. æ’­æ”¾å‹åˆ©éŸ³æ•ˆèˆ‡èªéŸ³
    playSound(880, 0.3);
    setTimeout(() => playSound(1100, 0.5), 200);
    
    // èªéŸ³æœƒå ±å‡ºåˆ†æ•¸ï¼Œå¢åŠ æˆå°±æ„Ÿ
    const msg = `æŒ‘æˆ°å®Œæˆï¼æ‚¨ç²å¾—äº† ${score} åˆ†`;
    window.speechSynthesis.speak(new SpeechSynthesisUtterance(msg));
}

        // --- 3. ç¿»ç‰Œé…å°é‚è¼¯ ---
        let flipped = [], matched = 0, canFlip = true, totalP = 0;
        function startMemoryGame() {
            hideAll();
            document.getElementById('memory-screen').style.display = 'block';
            document.getElementById('memory-difficulty-select').style.display = 'block';
            document.getElementById('memory-game-area').style.display = 'none';
        }

        function initMemoryGame(count) {
            const icons = ["ğŸ","ğŸ¶","ğŸ€","ğŸ¹","ğŸš—","ğŸ ","ğŸˆ","ğŸ¨"];
            totalP = count/2;
            let deck = [...icons.slice(0, totalP), ...icons.slice(0, totalP)];
            deck.sort(() => Math.random()-0.5);
            
            const grid = document.getElementById('memory-grid');
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = `repeat(${count === 6 ? 3 : (count === 8 ? 4 : 5)}, 1fr)`;
            
            deck.forEach(emoji => {
                const c = document.createElement('div');
                c.className = 'card';
                c.dataset.v = emoji;
                c.innerHTML = 'â“';
                c.onclick = () => {
                    if(!canFlip || c.classList.contains('flipped')) return;
                    playSound(400, 0.1);
                    c.classList.add('flipped'); c.innerText = c.dataset.v;
                    flipped.push(c);
                    if(flipped.length === 2) checkM();
                };
                grid.appendChild(c);
            });
            matched = 0;
            document.getElementById('memory-difficulty-select').style.display = 'none';
            document.getElementById('memory-game-area').style.display = 'block';
            const statusText = document.getElementById('memory-status');
    if(statusText) {
        statusText.innerText = "è«‹ç¿»é–‹å…©å¼µç‰Œ";
        statusText.style.color = "#2c3e50";
           }
        }
       
        function checkM() {
    canFlip = false;
    const [a, b] = flipped;
    // æŠ“å–ç‹€æ…‹æ–‡å­—å…ƒç´ 
    const statusText = document.getElementById('memory-status');

    if (a.dataset.v === b.dataset.v) {
        // --- é…å°æˆåŠŸ ---
        setTimeout(() => {
            a.classList.add('matched');
            b.classList.add('matched');
            
            // å¼·åˆ¶æ›´æ–°æ–‡å­—èˆ‡é¡è‰²
            statusText.style.display = "block"; 
            statusText.style.color = "#2ed573"; 
            statusText.innerText = "â­ é…å°æˆåŠŸï¼";
            
            playSound(1000, 0.3);
            flipped = [];
            canFlip = true;
            matched++;

            if (matched === totalP) {
                statusText.innerText = "ğŸŠ æ­å–œå…¨éƒ¨é€šé—œï¼";
                window.speechSynthesis.speak(new SpeechSynthesisUtterance("æ­å–œé€šé—œ"));
            }
        }, 500);
    } else {
        // --- é…å°å¤±æ•— ---
        // 1. ç«‹åˆ»é¡¯ç¤ºéŒ¯èª¤æ–‡å­—
        statusText.style.display = "block";
        statusText.style.color = "#ff4757"; // å¼·åˆ¶è®Šç´…è‰²
        statusText.innerText = "âŒ ä¸ä¸€æ¨£å–”ï¼Œå†è©¦è©¦ï¼";
        
        // 2. åœé “ 2 ç§’
        setTimeout(() => {
            a.classList.remove('flipped'); a.innerText = 'â“';
            b.classList.remove('flipped'); b.innerText = 'â“';
            
            // 3. æ¢å¾©åˆå§‹æç¤º
            statusText.innerText = "è«‹å†ç¿»å…©å¼µç‰Œ";
            statusText.style.color = "#2c3e50";
            
            flipped = [];
            canFlip = true;
        }, 2000); 
    }
}

        // --- 4. æ•¸é‡æŒ‘æˆ°é‚è¼¯ ---
        let countRound = 1, countAns = 0;
        
        function startCountGame() {
            hideAll(); 
            countRound = 1;
            document.getElementById('count-screen').style.display = 'block';
            nextCountQ();
        }

        function nextCountQ() {
            if (countRound > 5) {
                hideAll();
                document.getElementById('count-result-screen').style.display = 'block';
                playSound(880, 0.5);
                window.speechSynthesis.speak(new SpeechSynthesisUtterance("æ­å–œé€šé—œ"));
                return;
            }
            
            document.getElementById('count-feedback').innerText = ""; // æ¸…ç©ºåé¥‹
            document.getElementById('count-progress').innerText = `ç¬¬ ${countRound} / 5 é¡Œ`;
            
            const area = document.getElementById('count-display-area');
            area.innerHTML = '';
            
            countAns = Math.floor(Math.random() * 4) + 1;
            const iconPool = ["ğŸ", "ğŸ±", "ğŸš—", "âš½", "ğŸ¥", "ğŸ“"];
            const icon = iconPool[Math.floor(Math.random() * iconPool.length)];
            
            for (let i = 0; i < countAns; i++) {
                area.innerHTML += `<span>${icon}</span>`;
            }
            window.speechSynthesis.speak(new SpeechSynthesisUtterance("ç•«é¢ä¸­æœ‰å¹¾å€‹ï¼Ÿ"));
        }

        function checkCount(n) {
            const feedback = document.getElementById('count-feedback');
            if (n === countAns) {
                feedback.innerText = "â­ å¤ªæ£’äº†ï¼ç­”å°äº†ï¼";
                feedback.style.color = "#2ed573";
                playSound(1000, 0.2);
                window.speechSynthesis.speak(new SpeechSynthesisUtterance("ç­”å°äº†"));
                setTimeout(() => {
                    countRound++;
                    nextCountQ();
                }, 800);
            } else {
                feedback.innerText = "âŒ ä¸å°å–”ï¼Œå†æ•¸ä¸€æ¬¡çœ‹çœ‹ï¼";
                feedback.style.color = "#ff4757";
                playSound(200, 0.3);
                window.speechSynthesis.speak(new SpeechSynthesisUtterance("å†æ•¸ä¸€æ¬¡"));
            }
        }

        // --- æš«åœåŠŸèƒ½ ---
        function togglePause(r) {
    isPaused = true;
    
  // åœ¨ togglePause è£¡é¢åŠ å…¥é€™ä¸€è¡Œ
if (isBodyMode) {
    clearInterval(bodyGameTimer); // æš«åœ 60 ç§’å€’æ•¸
    clearTimeout(bodyTimer);      // æš«åœå‹•ä½œåˆ‡æ›
}
    // åœæ­¢é‚è¼¯è¨ˆæ™‚
    clearTimeout(answerTimeout);
    clearInterval(visualCountdownInterval);
    if(r || isRhythmMode) { 
        clearInterval(rhythmTimer); 
        clearInterval(countdownTimer); 
    }
    if(typeof bodyTimer !== 'undefined') {
        clearTimeout(bodyTimer); // åœæ­¢å‹•å‹•æ“çš„åˆ‡æ›è¨ˆæ™‚
    }
    // --- é—œéµä¿®æ­£ï¼šè®“é€²åº¦æ¢åœåœ¨ç•¶å‰ä½ç½® ---
    const fill = document.getElementById('progress-fill');
    const computedStyle = window.getComputedStyle(fill);
    const currentWidth = computedStyle.getPropertyValue('width'); // å–å¾—ç•¶å‰è·‘åˆ°çš„å¯¬åº¦
    const bodyFill = document.getElementById('body-progress-fill');
    if(bodyFill) {
        const currentWidth = window.getComputedStyle(bodyFill).getPropertyValue('width');
        bodyFill.style.transition = 'none';
        bodyFill.style.width = currentWidth;
    }
    fill.style.transition = 'none'; // ç§»é™¤å‹•ç•«
    fill.style.width = currentWidth; // å›ºå®šå¯¬åº¦

    document.getElementById('pause-overlay').style.display = 'flex';
}

function resumeWithCountdown() {
    document.getElementById('pause-content').style.display = 'none';
    const c = document.getElementById('resume-countdown');
    c.style.display = 'block';
    
    let s = 3; 
    c.innerText = s;

    // åˆå§‹éŸ³æ•ˆèˆ‡èªéŸ³
    playSound(400, 0.1, 'square'); 
    window.speechSynthesis.speak(new SpeechSynthesisUtterance("3"));

    let itv = setInterval(() => {
        s--;
        
        if(s > 0) {
            // å€’æ•¸æ•¸å­— 2 å’Œ 1 çš„è²éŸ³
            c.innerText = s;
            playSound(400, 0.1, 'square'); 
            window.speechSynthesis.speak(new SpeechSynthesisUtterance(s.toString()));
        } else if (s === 0) {
            // --- é‡é»ä¿®æ”¹ï¼šGO çš„æ™‚åˆ» ---
            c.innerText = "GO!";
            c.style.color = "#2ed573"; // è®Šæˆç¶ è‰²
            
            // æ’­æ”¾ä¸€å€‹ç‰¹åˆ¥äº®çœ¼ã€é »ç‡è¼ƒé«˜çš„é–‹å ´éŸ³
            playSound(1200, 0.4, 'sine'); 
            window.speechSynthesis.speak(new SpeechSynthesisUtterance("é–‹å§‹"));

            // ç¨å¾®åœé “ä¸€å°æ®µæ™‚é–“è®“é•·è¼©çœ‹åˆ° "GO!" å­—æ¨£ï¼Œå†é—œé–‰é®ç½©
            setTimeout(() => {
                clearInterval(itv);
                document.getElementById('pause-overlay').style.display = 'none';
                document.getElementById('pause-content').style.display = 'block';
                c.style.display = 'none'; 
                c.style.color = "#f1c40f"; // æŠŠé¡è‰²æ”¹å›åŸæœ¬çš„é»ƒè‰²ä¾›ä¸‹æ¬¡ä½¿ç”¨
                isPaused = false;

                // æ¢å¾©åŸæœ¬éŠæˆ²çš„è¨ˆæ™‚
                if (isRhythmMode) {
        startTimers(); 
    } else if (typeof isBodyMode !== 'undefined' && isBodyMode) {
        startBodyCountdown(); // æ¢å¾©ç¸½æ™‚é–“å€’æ•¸
        
        // --- ä¿®æ­£è™•ï¼šåªé‡è¨­é¬§é˜ï¼Œä¸ç«‹åˆ»æ›é¡Œ ---
        clearTimeout(bodyTimer); 
        bodyTimer = setTimeout(() => {
            if(!isPaused && isBodyMode) nextBodyAction();
        }, 4000); 

        // è®“é€²åº¦æ¢é‡æ–°é–‹å§‹è·‘å‹•ç•«
        const bodyFill = document.getElementById('body-progress-fill');
        if(bodyFill) {
            bodyFill.style.transition = 'width 4s linear';
            bodyFill.style.width = '100%';
        }
           // 2. æ¢å¾©èº«é«”å‹•ä½œåˆ‡æ› // ğŸ‘ˆ é—œéµï¼šæ¢å¾©å‹•å‹•æ“çš„åˆ‡æ›ï¼
    } else if (document.getElementById('game-screen').style.display === 'block') {
        continueChallengeTimer(); 
    }
    // --------------------
}, 500); // é€™è£¡çš„ 500 æ¯«ç§’æ˜¯è®“ GO åœç•™åœ¨è¢å¹•ä¸Šçš„æ™‚é–“
        }
    }, 1000);
}

let bodyParts = [
    {e:"ğŸ™†â€â™‚ï¸", n:"æ‘¸æ‘¸é ­"}, {e:"ğŸ‘ƒ", n:"æ‘¸æ‘¸é¼»å­"}, {e:"ğŸ‘‚", n:"æ‘¸æ‘¸è€³æœµ"}, 
    {e:"ğŸ’ª", n:"æ‘¸æ‘¸è‚©è†€"}, {e:"ğŸ‘", n:"æ‹æ‹é›™æ‰‹"}, {e:"ğŸ˜Š", n:"æ‘¸æ‘¸è‡‰é °"}, 
    {e:"ğŸ‘€", n:"æŒ‡æŒ‡çœ¼ç›"}, {e:"ğŸ‘„", n:"æŒ‡æŒ‡å˜´å·´"}
];
let bodyTimeLeft = 60;
let bodyGameTimer; // ç”¨ä¾†å­˜ 60 ç§’å€’æ•¸çš„è¨ˆæ™‚å™¨

function startBodyGame() {
    hideAll();
    isBodyMode = true; // æ–°å¢é€™è¡Œ
    isRhythmMode = false; // æ–°å¢é€™è¡Œ
    isPaused = false;
    bodyTimeLeft = 60; // é‡è¨­æ™‚é–“

    document.getElementById('body-screen').style.display = 'block';
    document.getElementById('body-timer-text').innerText = "01:00";
    
    startBodyCountdown(); // å•Ÿå‹•ç¸½æ™‚é–“å€’æ•¸
    nextBodyAction();     // å•Ÿå‹•å‹•ä½œåˆ‡æ›
}

function startBodyCountdown() {
    clearInterval(bodyGameTimer);
    bodyGameTimer = setInterval(() => {
        if (!isPaused) {
            bodyTimeLeft--;
            let m = Math.floor(bodyTimeLeft / 60);
            let s = bodyTimeLeft % 60;
            document.getElementById('body-timer-text').innerText = 
                `${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
            
            if (bodyTimeLeft <= 0) {
                endBodyGame();
            }
        }
    }, 1000);
}

// æ–°å¢çµæŸéŠæˆ²å‡½æ•¸
function endBodyGame() {
    isBodyMode = false;
    clearInterval(bodyGameTimer);
    clearTimeout(bodyTimer);
    hideAll();
    // ä½¿ç”¨åŸæœ¬ç¾æœ‰çš„çµæœç•«é¢
    document.getElementById('body-result-screen').style.display = 'block'; 
    playSound(880, 0.5);
    window.speechSynthesis.speak(new SpeechSynthesisUtterance("å¤ªæ£’äº†ï¼Œé‹å‹•å®Œæˆï¼Œä¼‘æ¯ä¸€ä¸‹å§"));
}

function nextBodyAction() {
    if(isPaused) return;
    
    // éš¨æ©Ÿé¸ä¸€å€‹å‹•ä½œ
    const action = bodyParts[Math.floor(Math.random() * bodyParts.length)];
    
    // é¡¯ç¤ºç•«é¢
    document.getElementById('body-display-emoji').innerText = action.e;
    document.getElementById('body-display-text').innerText = action.n;
    
    // èªéŸ³å¼•å°
    window.speechSynthesis.speak(new SpeechSynthesisUtterance(action.n));

    // é€²åº¦æ¢å‹•ç•« (4ç§’æ›ä¸€æ¬¡)
    const fill = document.getElementById('body-progress-fill');
    fill.style.transition = 'none';
    fill.style.width = '0%';
    fill.style.backgroundColor = '#2ed573';

    setTimeout(() => {
        fill.style.transition = 'width 4s linear';
        fill.style.width = '100%';
    }, 50);

    // 4ç§’å¾Œè‡ªå‹•æ›ä¸‹ä¸€å€‹
    bodyTimer = setTimeout(() => {
        if(!isPaused) nextBodyAction();
    }, 4000);
}

    </script>
</body>
</html>

